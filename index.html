<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login â€“ Dream11</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* animated username label */
    .form-control {
      position: relative;
      margin: 20px 0 40px;
      width: 100%;
    }
    .form-control input {
      background: transparent;
      border: 0;
      border-bottom: 2px #fff solid;
      display: block;
      width: 100%;
      padding: 15px 0;
      font-size: 18px;
      color: #fff;
    }
    .form-control input:focus,
    .form-control input:valid {
      outline: 0;
      border-bottom-color: lightblue;
    }
    .form-control label {
      position: absolute;
      top: 15px;
      left: 0;
      pointer-events: none;
    }
    .form-control label span {
      display: inline-block;
      font-size: 18px;
      min-width: 5px;
      color: #fff;
      transition: 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    .form-control input:focus + label span,
    .form-control input:valid + label span {
      color: lightblue;
      transform: translateY(-30px);
    }

    /* Hide elements initially */
    #loginContent {
      display: none;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-[#0d0d0d] to-[#111] text-white min-h-screen flex items-center justify-center">

  <!-- LOADING ANIMATION -->
  <div id="loadingAnimation" class="flex items-center justify-center min-h-screen">
    <div class="relative">
      <div class="relative w-32 h-32">
        <div
          class="absolute w-full h-full rounded-full border-[3px] border-gray-100/10 border-r-[#0ff] border-b-[#0ff] animate-spin"
          style="animation-duration: 3s;"
        ></div>

        <div
          class="absolute w-full h-full rounded-full border-[3px] border-gray-100/10 border-t-[#0ff] animate-spin"
          style="animation-duration: 2s; animation-direction: reverse;"
        ></div>
      </div>

      <div
        class="absolute inset-0 bg-gradient-to-tr from-[#0ff]/10 via-transparent to-[#0ff]/5 animate-pulse rounded-full blur-sm"
      ></div>
    </div>
  </div>

  <!-- LOGIN CONTENT -->
  <div id="loginContent" class="w-full max-w-md mx-auto">
    <div class="bg-white/5 backdrop-blur-md border border-white/10 rounded-3xl shadow-2xl p-8">

      <!-- Logo -->
      <div class="flex justify-center mb-8">
        <img src="https://www.pngplay.com/wp-content/uploads/6/Dream11-Logo-PNG-Clipart-Background.png" class="h-20" alt="Dream11">
      </div>

      <!-- Email / Pass -->
      <form id="loginForm" class="space-y-4">
        <input type="email" id="email" required placeholder="Email" class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <input type="password" id="pass" required placeholder="Password" class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <button type="submit" class="w-full py-3 bg-blue-600 hover:bg-blue-700 rounded-xl font-semibold transition">Log in</button>
      </form>

      <!-- Google -->
      <button id="googleBtn" class="w-full mt-4 py-3 bg-white/10 hover:bg-white/20 rounded-xl font-semibold flex items-center justify-center gap-2 transition">
        <svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="#EA4335" d="M12 5c1.6167603 0 3.1012573.5535278 4.2863159 1.4740601l3.637146-3.4699707C17.8087769 1.1399536 15.0406494 0 12 0 7.392395 0 3.3966675 2.5999146 1.3858032 6.4098511l4.0444336 3.1929321C6.4099731 6.9193726 8.977478 5 12 5z"/><path fill="#34A853" d="M23.8960571 13.5018311C23.9585571 13.0101929 24 12.508667 24 12c0-.8578491-.093689-1.6931763-.2647705-2.5H12v5h6.4862061c-.5247192 1.3637695-1.4589844 2.5177612-2.6481934 3.319458l4.0594482 3.204834C22.0493774 19.135437 23.5219727 16.4903564 23.8960571 13.5018311z"/><path fill="#FBBC05" d="M5 12c0-.8434448.1568604-1.6483765.4302368-2.3972168L1.3858032 6.4098511C.5043335 8.0800171 0 9.9801636 0 12c0 1.9972534.4950562 3.8763428 1.3582153 5.532959l4.0495605-3.1970215C5.1484375 13.6044312 5 12.8204346 5 12z"/><path fill="#4285F4" d="M12 19c-3.0455322 0-5.6295776-1.9484863-6.5922241-4.6640625L1.3582153 17.532959C3.3592529 21.3734741 7.369812 24 12 24c3.027771 0 5.7887573-1.1248169 7.8974609-2.975708l-4.0594482-3.204834C14.7412109 18.5588989 13.4284058 19 12 19z"/></svg>
        <span>Sign in with Google</span>
      </button>

      <!-- Demo ID -->
      <button id="demoBtn" class="w-full mt-3 py-3 bg-white/10 hover:bg-white/20 rounded-xl font-semibold">Use Demo ID</button>

      <!-- Progress bar (hidden by default) -->
      <div id="progressBar" class="hidden mt-4">
        <div class="h-1 w-full bg-white/20 rounded-full overflow-hidden">
          <div class="h-full bg-blue-500 animate-pulse" style="width:0%" id="progressFill"></div>
        </div>
        <p id="progressText" class="text-center text-sm mt-2">Signing up...</p>
      </div>

      <!-- Username (hidden until needed) -->
      <div id="usernameWrap" class="hidden mt-4">
        <div class="form-control">
          <input type="text" id="username" required>
          <label>
            <span style="transition-delay:0ms">U</span><span style="transition-delay:50ms">s</span><span style="transition-delay:100ms">e</span><span style="transition-delay:150ms">r</span><span style="transition-delay:200ms">n</span><span style="transition-delay:250ms">a</span><span style="transition-delay:300ms">m</span><span style="transition-delay:350ms">e</span>
          </label>
        </div>
        <button id="continueBtn" class="w-full py-3 bg-green-600 hover:bg-green-700 rounded-xl font-semibold transition">Continue</button>
      </div>

    </div>
  </div>

  <script>
    // DOM Elements
    const loadingAnimation = document.getElementById('loadingAnimation');
    const loginContent = document.getElementById('loginContent');
    const loginForm   = document.getElementById('loginForm');
    const googleBtn   = document.getElementById('googleBtn');
    const demoBtn     = document.getElementById('demoBtn');
    const progressBar = document.getElementById('progressBar');
    const progressFill= document.getElementById('progressFill');
    const progressText= document.getElementById('progressText');
    const usernameWrap= document.getElementById('usernameWrap');
    const usernameInp = document.getElementById('username');
    const continueBtn = document.getElementById('continueBtn');

    let isDemo = false;

    // Check if user is already logged in and redirect if not coming from logout
    function checkExistingSession() {
      // Check if user has any stored login data
      const userKeys = Object.keys(localStorage).filter(key => key.startsWith('user_'));
      
      if (userKeys.length > 0 && !window.location.hash.includes('logout')) {
        // User has previous login data and not coming from logout
        const latestUserKey = userKeys[userKeys.length - 1];
        const userData = JSON.parse(localStorage.getItem(latestUserKey));
        
        if (userData && userData.username) {
          // Redirect to home page after a brief delay to show loading animation
          setTimeout(() => {
            const amt = userData.email.includes('demo') ? '199' : '150';
            window.location.href = `/home#${userData.username}#${amt}`;
          }, 800);
          return true;
        }
      }
      return false;
    }

    // Initialize page
    function init() {
      // Show loading animation first
      loadingAnimation.style.display = 'flex';
      loginContent.style.display = 'none';
      
      // Check for existing session after a brief delay
      setTimeout(() => {
        const hasExistingSession = checkExistingSession();
        
        if (!hasExistingSession) {
          // No existing session, show login form
          loadingAnimation.style.display = 'none';
          loginContent.style.display = 'block';
        }
      }, 1500);
    }

    // Common redirect function
    function goHome(user){
      const amt = isDemo ? '199' : '150';
      window.location.href = `/home#${user}#${amt}`;
    }

    // Email/pass login
    loginForm.addEventListener('submit', e => {
      e.preventDefault();
      const email = document.getElementById('email').value.trim();
      const pass  = document.getElementById('pass').value.trim();
      if(!email || !pass) return;
      const key = `user_${email}`;
      
      if(!localStorage.getItem(key)){
        // New user - sign up flow
        localStorage.setItem(key, JSON.stringify({email, pass}));
        showProgress();
        setTimeout(()=>{
          hideProgress();
          askUsername(email);
        },1200);
      }else{
        // Existing user - login flow
        showProgress();
        setTimeout(()=>{
          const userData = JSON.parse(localStorage.getItem(key));
          goHome(userData.username || email.split('@')[0]);
        },800);
      }
    });

    // Google login
    googleBtn.addEventListener('click', ()=>{
      showProgress();
      setTimeout(()=>{
        hideProgress();
        askUsername('google_user');
      },2000);
    });

    // Demo login
    demoBtn.addEventListener('click', ()=>{
      isDemo = true;
      showProgress();
      setTimeout(()=>{
        goHome('demo_user');
      },800);
    });

    // Username ask function
    function askUsername(prefix){
      usernameWrap.classList.remove('hidden');
      usernameInp.value = '';
      usernameInp.focus();
      continueBtn.onclick = ()=>{
        const u = usernameInp.value.trim() || prefix.split('@')[0];
        localStorage.setItem(`user_${prefix}`, JSON.stringify({email:prefix, username:u}));
        goHome(u);
      };
    }

    // Progress helpers
    function showProgress(){
      progressBar.classList.remove('hidden');
      let w = 0;
      const t = setInterval(()=>{
        w+=3;
        progressFill.style.width = w+'%';
        if(w>=100){clearInterval(t);}
      },30);
    }
    
    function hideProgress(){
      progressBar.classList.add('hidden');
      progressFill.style.width = '0%';
    }

    // Initialize the application
    init();
  </script>

</body>
</html>
